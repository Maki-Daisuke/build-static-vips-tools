# Portable & Statically Linked Vips Tools for Linux

Build statically-linked, portable [libvips](https://www.libvips.org/) command-line tools (v8.18.0) for Linux — no runtime dependencies required.

## Overview

This project uses Docker to statically link libvips tools on Alpine Linux 3.23, generating standalone binaries with minimal dependencies.
The generated binaries operate independently of the libc and can run on most Linux environments as is.

### Output Binaries

The following vips command-line tools are built:

- `vips` — General-purpose image processing command
- `vipsthumbnail` — High-performance thumbnail generator
- `vipsedit` — Image metadata editor
- `vipsheader` — Image header/metadata viewer

### Supported Formats

| Format | Library | Version | License |
| ------ | ------- | ------- | ------- |
| JPEG | libjpeg-turbo | (Alpine package) | BSD-3-Clause / IJG / zlib |
| PNG | libpng + libspng + libimagequant | (Alpine) / 0.7.4 / 4.4.1 | libpng License / BSD-2-Clause / GPLv3 |
| WebP | libwebp | (Alpine package) | BSD-3-Clause |
| TIFF | libtiff | 4.7.1 | libtiff License |
| GIF | giflib | (Alpine package) | MIT |
| HEIF / HEIC | libheif + libde265 | 1.17.6 / 1.0.16 | LGPLv3 / LGPLv3 |
| AVIF | libheif + libaom | 1.17.6 / 3.6.1 | LGPLv3 / BSD-2-Clause |
| JPEG 2000 | OpenJPEG | 2.5.4 | BSD-2-Clause |
| OpenEXR | OpenEXR + Imath | 3.4.4 / 3.2.2 | BSD-3-Clause / BSD-3-Clause |
| FITS | cfitsio | 4.6.3 | NASA Open Source Agreement |
| PDF | poppler + cairo | 26.02.0 / 1.18.4 | GPLv2+ / (LGPLv2.1 or MPL-1.1) |
| SVG | librsvg | 2.61.4 | LGPLv2+ |

> **License Note:**
> While libvips itself is distributed under **LGPL-2.1+**, the binaries generated by this project statically link against **GPLv3** libraries, placing the resulting distribution under **GPLv3**.
>
> If you do not need specific libraries (e.g. to avoid GPLv3 dependencies), you can simply comment them out or remove them from the `Dockerfile` and build your own binaries that meet your licensing requirements.

Additional libraries:

| Library | Purpose | Version | License | Notes |
| ------- | ------- | ------- | ------- | ----- |
| lcms2 | ICC color management | 2.18 | MIT | |
| libexif | EXIF metadata / auto-rotation | 0.6.25 | LGPLv2.1 | |
| Highway | SIMD acceleration | 1.3.0 | Apache-2.0 / BSD-3-Clause | |
| ORC | SIMD acceleration | 0.4.41 | BSD-2-Clause | |
| dav1d | AV1 decoder | 1.5.3 | BSD-2-Clause | Required by librsvg |
| libeconf | Configuration parser | 0.8.3 | MIT | Statically built (apk lacks static lib) |
| fftw | Fourier transform | (Alpine package) | GPLv2+ | |

## Prerequisites

- Docker with `buildx` support

### Cross-Compilation

If you need to cross-compile (e.g. build for ARM64 on x86_64), you must register QEMU user-mode emulation binaries:

```bash
docker run --privileged --rm tonistiigi/binfmt --install all
```

### Build Requirements

> [!NOTE]
> The final linking stage is very memory-intensive due to the large number of statically-linked dependencies.
> The build uses `ninja -j 2` (instead of `-j$(nproc)`) to avoid OOM errors.
> Ensure your Docker environment has sufficient memory (16 GB+ recommended) and disk space.

## Usage

### 1. Build using `docker buildx`

```bash
# Build for ARM64 (cross-compilation from x86_64)
docker buildx build --platform linux/arm64 -t vips-tools-arm64 --load .

# Build for x86_64 (native build)
docker buildx build --platform linux/amd64 -t vips-tools-amd64 --load .
```

This command will compile everything and place the resulting vips tools into `/output` directory in the container.

### 2. Create a container

```bash
docker create --name vips vips-tools-arm64
```

### 3. Extract the binaries

```bash
docker cp -a vips:/output - |tar -xf -
```

### 4. Use the binaries

```bash
# Generate a 256px thumbnail
./output/vipsthumbnail input.jpg -s 256 -o thumb.jpg

# View image metadata
./output/vipsheader input.png

# Convert between formats
./output/vips copy input.jpg output.webp
```

## License

The Dockerfile and scripts in this repository are released under **CC0**:

[CC0 1.0 Universal (CC0 1.0) Public Domain Dedication](https://creativecommons.org/publicdomain/zero/1.0/)

However, the binaries generated by this project are distributed under **GPLv3**:

[General Public License version 3](https://www.gnu.org/licenses/gpl-3.0.html)

This is because the generated binaries statically link against various third-party libraries, each with its own license (including GPL and LGPL).
Use of the generated binaries must comply with the licenses of these dependencies.

## Author

Daisuke (yet another) Maki
